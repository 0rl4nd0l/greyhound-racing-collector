# Flask API Prediction Endpoints Analysis
*Generated: 2025-08-21 19:56:29*

## Server Health Check
- **Endpoint**: `GET http://localhost:5002/health`
- **Status**: ✅ Available
- **Response**: Components show database connected, prediction_pipeline available, ml_system unavailable

## Available Prediction Endpoints

### 1. Batch Prediction API
- **Endpoint**: `POST http://localhost:5002/api/batch/predict`
- **Purpose**: Process multiple CSV files in batch
- **Request Body**:
```json
{
  "files": ["path/to/file1.csv", "path/to/file2.csv"]
}
```
- **Response**: 
```json
{
  "success": true, 
  "job_id": "batch_job_id", 
  "message": "Batch prediction started"
}
```
- **Limitation**: Requires CSV files as input, not suitable for re-predicting existing JSON predictions

### 2. Batch Status/Progress APIs  
- **Endpoints**: 
  - `GET /api/batch/status/<job_id>`
  - `GET /api/batch/progress/<job_id>`
  - `POST /api/batch/cancel/<job_id>`
- **Purpose**: Monitor batch prediction jobs

### 3. Web Interface Prediction
- **Endpoint**: `POST http://localhost:5002/predict_page` 
- **Purpose**: Web form-based prediction (not REST API)
- **Method**: Uses PredictionPipelineV4 → V3 → UnifiedPredictor fallback chain
- **Limitation**: Web interface only, requires form submission

## Assessment for Historical Re-prediction

### ❌ No Direct Historical Re-prediction API
**Finding**: No REST endpoint found that accepts:
- `race_url` for scraping and re-predicting
- `(track, date, race_number)` tuple for database lookup and re-prediction  
- Existing prediction JSON for enhancement

### ✅ Available Components
- **PredictionPipelineV4**: Available and working
- **Database**: Connected with race_metadata table
- **File Resolution**: `resolve_race_file_path()` function can find CSV files across directories

## Recommendation for Missing race_info Fix

Given the API limitations discovered:

### Primary Strategy: In-Place JSON Patching
- **Reason**: No suitable API endpoint for historical re-prediction
- **Approach**: Extract distance/grade from filenames, database lookups, and content analysis
- **Backup**: All files before modification

### Secondary Strategy: Database Enrichment  
- **Use**: Leverage existing database with race_metadata table
- **Query**: `SELECT distance, grade FROM race_metadata WHERE race_date = ? AND venue = ? AND race_number = ?`
- **Coverage**: Will likely cover many missing files

### API Enhancement Suggestion (Future)
Could add new endpoint:
```
POST /api/enrich_prediction
{
  "file_path": "predictions/prediction_file.json",
  "strategy": "database_first|filename_parsing|hybrid"
}
```

## Contract Summary

| Endpoint | Method | Purpose | Suitable for race_info fix |
|----------|--------|---------|---------------------------|
| `/health` | GET | Server status | ❌ No |
| `/api/batch/predict` | POST | Batch CSV processing | ❌ Requires CSVs |
| `/predict_page` | POST | Web form prediction | ❌ Web interface only |

**Conclusion**: No existing API endpoint suitable for historical race_info enrichment. Proceed with in-place JSON patching strategy.
