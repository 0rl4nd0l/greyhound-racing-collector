<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
     refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
    <style>
      .module { fill: #e1f5fe; stroke: #0277bd; stroke-width: 2; }
      .ensemble { fill: #f3e5f5; stroke: #7b1fa2; stroke-width: 2; }
      .traditional { fill: #e8f5e8; stroke: #388e3c; stroke-width: 2; }
      .pipeline { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; }
      .title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; }
      .arrow { stroke: #666; stroke-width: 2; marker-end: url(#arrowhead); }
      .data-flow { stroke: #d32f2f; stroke-width: 2; stroke-dasharray: 5,5; marker-end: url(#arrowhead); }
    </style>
  </defs>

  <!-- Title -->
  <text x="600" y="30" class="title" style="font-size: 18px;">Greyhound Prediction Pipeline Call Graph</text>
  
  <!-- Main Pipeline Controller -->
  <rect x="480" y="60" width="240" height="60" class="pipeline" rx="10"/>
  <text x="600" y="85" class="title">PredictionPipelineV3Strategy</text>
  <text x="600" y="105" class="text">predict_race_file()</text>

  <!-- ML System V3 (Core) -->
  <rect x="80" y="180" width="200" height="80" class="module" rx="10"/>
  <text x="180" y="205" class="title">MLSystemV3</text>
  <text x="180" y="225" class="text">train_model()</text>
  <text x="180" y="245" class="text">predict(dog_data)</text>

  <!-- Advanced Ensemble ML System -->
  <rect x="320" y="180" width="220" height="120" class="ensemble" rx="10"/>
  <text x="430" y="205" class="title">AdvancedEnsembleMLSystem</text>
  <text x="430" y="225" class="text">VotingClassifier</text>
  <text x="430" y="245" class="text">train_ensemble()</text>
  <text x="430" y="265" class="text">predict() â†’ win_probability</text>
  <text x="430" y="285" class="text">BettingStrategyOptimizer</text>

  <!-- Comprehensive Enhanced ML System -->
  <rect x="580" y="180" width="240" height="120" class="ensemble" rx="10"/>
  <text x="700" y="205" class="title">ComprehensiveEnhancedMLSystem</text>
  <text x="700" y="225" class="text">VotingClassifier ensemble</text>
  <text x="700" y="245" class="text">predict_race()</text>
  <text x="700" y="265" class="text">win_probability, place_probability</text>
  <text x="700" y="285" class="text">Traditional analysis integration</text>

  <!-- Traditional Analysis -->
  <rect x="860" y="180" width="200" height="80" class="traditional" rx="10"/>
  <text x="960" y="205" class="title">TraditionalRaceAnalyzer</text>
  <text x="960" y="225" class="text">analyze_race_factors()</text>
  <text x="960" y="245" class="text">calculate_scores()</text>

  <!-- Database Layer -->
  <rect x="300" y="380" width="300" height="60" class="module" rx="10"/>
  <text x="450" y="405" class="title">Database (SQLite)</text>
  <text x="450" y="425" class="text">dog_race_data, race_metadata</text>

  <!-- Feature Engineering -->
  <rect x="50" y="320" width="180" height="60" class="module" rx="10"/>
  <text x="140" y="345" class="title">Feature Engineering</text>
  <text x="140" y="365" class="text">_create_features()</text>

  <!-- Betting Strategy -->
  <rect x="650" y="320" width="200" height="60" class="ensemble" rx="10"/>
  <text x="750" y="345" class="title">BettingStrategyOptimizer</text>
  <text x="750" y="365" class="text">calculate_betting_value()</text>

  <!-- Model Training Components -->
  <rect x="880" y="320" width="180" height="80" class="ensemble" rx="10"/>
  <text x="970" y="345" class="title">Ensemble Models</text>
  <text x="970" y="365" class="text">RandomForest</text>
  <text x="970" y="385" class="text">GradientBoosting, XGBoost</text>

  <!-- Arrows showing call flow -->
  <!-- Main pipeline to systems -->
  <line x1="550" y1="120" x2="430" y2="180" class="arrow"/>
  <line x1="600" y1="120" x2="700" y2="180" class="arrow"/>
  <line x1="650" y1="120" x2="960" y2="180" class="arrow"/>
  
  <!-- ML System flows -->
  <line x1="180" y1="260" x2="140" y2="320" class="arrow"/>
  <line x1="180" y1="260" x2="350" y2="380" class="arrow"/>
  
  <!-- Advanced Ensemble flows -->
  <line x1="430" y1="300" x2="450" y2="380" class="arrow"/>
  <line x1="490" y1="280" x2="750" y2="320" class="arrow"/>
  <line x1="540" y1="230" x2="880" y2="320" class="arrow"/>
  
  <!-- Comprehensive Enhanced flows -->
  <line x1="700" y1="300" x2="550" y2="380" class="arrow"/>
  <line x1="760" y1="280" x2="960" y2="260" class="arrow"/>
  <line x1="800" y1="250" x2="970" y2="320" class="arrow"/>

  <!-- Data flow arrows (dashed red) -->
  <line x1="450" y1="380" x2="180" y2="260" class="data-flow"/>
  <line x1="450" y1="380" x2="430" y2="300" class="data-flow"/>
  <line x1="450" y1="380" x2="700" y2="300" class="data-flow"/>

  <!-- Legend -->
  <rect x="50" y="680" width="400" height="100" fill="#f5f5f5" stroke="#ccc" stroke-width="1" rx="5"/>
  <text x="250" y="700" class="title">Legend</text>
  <rect x="70" y="715" width="15" height="15" class="module"/>
  <text x="95" y="725" class="text" style="text-anchor: start;">Core ML Components</text>
  <rect x="70" y="735" width="15" height="15" class="ensemble"/>
  <text x="95" y="745" class="text" style="text-anchor: start;">Ensemble/Advanced ML</text>
  <rect x="250" y="715" width="15" height="15" class="traditional"/>
  <text x="275" y="725" class="text" style="text-anchor: start;">Traditional Analysis</text>
  <rect x="250" y="735" width="15" height="15" class="pipeline"/>
  <text x="275" y="745" class="text" style="text-anchor: start;">Pipeline Controller</text>
  <line x1="70" y1="760" x2="100" y2="760" class="arrow"/>
  <text x="110" y="765" class="text" style="text-anchor: start;">Method Calls</text>
  <line x1="250" y1="760" x2="280" y2="760" class="data-flow"/>
  <text x="290" y="765" class="text" style="text-anchor: start;">Data Flow</text>

  <!-- Key Insertion Points -->
  <circle cx="430" cy="240" r="8" fill="#ff5722"/>
  <text x="480" y="245" class="text" style="text-anchor: start; font-weight: bold;">VotingClassifier (Line 350)</text>
  
  <circle cx="700" cy="250" r="8" fill="#ff5722"/>
  <text x="750" y="255" class="text" style="text-anchor: start; font-weight: bold;">win_probability (Line 1890)</text>
  
  <circle cx="180" cy="235" r="8" fill="#ff5722"/>
  <text x="30" y="240" class="text" style="text-anchor: start; font-weight: bold;">win_probability (Line 191)</text>
  
  <circle cx="600" cy="95" r="8" fill="#ff5722"/>
  <text x="650" y="100" class="text" style="text-anchor: start; font-weight: bold;">win_probability (Line 182)</text>

</svg>
